# WebApp тесты (FastAPI) — кратко

## Назначение

Проверить, что `WebApp` корректно обрабатывает запросы к своим основным эндпоинтам:
-   Управление сессиями (`/sessions/*`).
-   Вызов LLM-фич (`/features/*`).
-   Экспорт в PDF (`/pdf/*`).

**Важно:** Тесты OAuth-интеграции и аутентификации вынесены в `tests/auth/`.

## Файлы

-   **`conftest.py`**: Общие фикстуры для тестов `webapp`.
    -   Создаёт временную SQLite БД.
    -   Предоставляет `httpx.AsyncClient` для выполнения запросов к приложению без запуска реального сервера.
-   **`test_sessions_and_features.py`**: Тестирует флоу работы с сессиями через JSON.
    -   Инициализация сессии через `/sessions/init_json`.
    -   Проверка дедупликации документов по хэшу.
    -   Запуск LLM-фич с использованием `session_id`.
-   **`test_sessions_upload.py`**: Тестирует флоу инициализации сессии через загрузку файлов.
    -   Инициализация через `POST /sessions/init_upload` (multipart/form-data).
    -   Проверка, что парсеры (LLM и HH) вызываются только для новых документов.

## Запуск

-   `pip install -r requirements.txt`
-   `pytest -q tests/webapp`

## Заметки

-   Тесты полностью изолированы от внешней сети и реальных API ключей.
-   Используется временная база данных для каждого тестового прогона.