# Обзор архитектуры

В этом документе представлен высокоуровневый обзор архитектуры системы, включая основные компоненты и процесс аутентификации.

## Компоненты

Система состоит из двух основных компонентов:

- **Callback Server (`src/callback_server`):** Легковесный сервер на FastAPI, отвечающий за одну задачу: перехват `authorization_code` в процессе OAuth2. Он запускается, ожидает перенаправления пользователя от провайдера аутентификации, сохраняет код во временный файл и завершает работу.

- **HH Adapter (`src/hh_adapter`):** Комплексный клиент для API HH.ru. Он управляет токенами (обмен кода на токены, их автоматическое обновление) и предоставляет чистый интерфейс для выполнения запросов к API.

## Процесс аутентификации

Диаграмма ниже иллюстрирует полный процесс аутентификации:

```mermaid
sequenceDiagram
    participant User as Пользователь
    participant App as Основное приложение
    participant Callback as Callback Server
    participant HH as HH.ru API

    App->>+Callback: Запустить сервер в фоновом режиме
    App->>User: Открыть браузер с URL для аутентификации
    User->>+HH: Войти и предоставить доступ
    HH-->>-User: Перенаправить на http://localhost/callback?code=...
    User->>+Callback: Запросить /callback?code=...
    Callback-->>-User: Показать страницу "Успех"
    Callback->>App: Сохранить код в файл и выключиться
    App->>App: Прочитать код из файла
    App->>HH: Обменять код на токены
    HH-->>App: Вернуть access и refresh токены
    App->>HH: Делать запросы к API с access токеном
    HH-->>App: Вернуть запрошенные данные
```
